<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç¾é£Ÿæ¨è–¦å™¨</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
body {
  font-family: "Noto Sans TC", sans-serif;
  background: #fff8f0;
  color: #4a3b2c;
  margin: 0;
  padding: 0;
}

.hero {
  background-image: url("https://img.freepik.com/premium-vector/food-pattern-seamless_534604-531.jpg");
  background-size: cover;
  background-position: center;
  color: #fff8f0;
  text-align: center;
  padding: 4rem 1rem;
  position: relative;
}

.hero::after {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(245, 139, 84, 0.3);
  z-index: 0;
}

.hero h1 {
  position: relative; z-index: 1;
  font-size: 2.8rem;
  letter-spacing: 0.05em;
  font-weight: 700;
  color: #fff8f0;
  margin: 0;
  text-shadow: 1px 1px 4px rgba(0,0,0,0.1);
}

header {
  background: #f4c095;
  display: flex;
  justify-content: center;
  gap: 2rem;
  padding: 1rem 0;
  position: sticky;
  top: 0;
  z-index: 2;
  border-bottom: 2px solid #f58b54;
}

header a {
  text-decoration: none;
  color: #4a3b2c;
  font-weight: 600;
  font-size: 1.1rem;
  transition: 0.3s;
}

header a:hover { color: #f58b54; }

section{
  display: none;
  padding: 2rem;
  max-width: 700px;
  margin: auto;
  background: #fff0e6;      /* çµ±ä¸€èƒŒæ™¯è‰² */
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(245, 139, 84, 0.15);
  margin-top: 2rem;
  border: 1px solid #f4c095;  /* çµ±ä¸€é‚Šæ¡† */
}

section.active{
  display: block;
}

h2 {
  text-align: center;
  color: #f58b54;
  border-bottom: 2px solid #f58b54;
  padding-bottom: 0.5rem;
}

label { display: block; margin: 10px 0; color: #4a3b2c; }

select, input[type="text"], button {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #f4c095;
  font-size: 1rem;
  background: #fff8f0;
  color: #4a3b2c;
}

select:focus, input[type="text"]:focus {
  outline: none;
  border-color: #f58b54;
  box-shadow: 0 0 5px #f58b54;
}

.checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.checkbox-group label {
  display: inline-flex;        /* è®“ checkbox å’Œæ–‡å­—æ°´å¹³æ’åˆ— */
  align-items: center;         /* å‚ç›´ç½®ä¸­ */
  gap: 6px;                    /* checkbox å’Œæ–‡å­—çš„è·é›¢ */
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
  border: 1px solid #f4c095;
  background: #fff0e6;
  white-space: nowrap;         /* ğŸ”¥ é˜²æ­¢æ›è¡Œ */
  width: auto;                 /* ğŸ”¥ è®“æ¡†æ¡†å›ºå®šåœ¨æœ€é©å¯¬åº¦ï¼Œä¸æœƒäº‚æ’ */
}

.checkbox-group label:hover { background: #ffe3d1; }

button {
  background-color: #f58b54;
  color: white;
  border: none;
  cursor: pointer;
  margin-top: 20px;
  font-weight: 700;
  transition: 0.3s;
}

button:hover { background-color: #f79465; }

#map, #mapFilter, #mapMood, #mapCustom {
  height: 300px;
  width: 100%;
  margin-top: 10px;
  border-radius: 12px;
}

  .category-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 1rem;
  }

  .category-buttons button {
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid #f4c095;
    background: #fff0e6;
    color: #4a3b2c;
    cursor: pointer;
    transition: 0.3s;
    }

  .category-buttons button:hover {
    background: #ffe3d1;
  }

  .mood-selector {
    max-width: 420px;
    margin: 30px auto;
    padding: 20px;
    background-color: #fff0e6;
    border: 1px solid #f4c095;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(245, 139, 84, 0.15);
  }

  .mood-option {
    display: block;
    margin: 10px 0;
    padding: 14px 12px;
    border: 2px solid #ffb347;
    border-radius: 10px;
    background-color: #fff3e0;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 16px;
    user-select: none;
  }

  /* éš±è— checkbox */
  .mood-option input[type="checkbox"] {
    display: none;
  }

  /* è¢«é¸åˆ°çš„æ•´å€‹å¡ç‰‡è®Šè‰² */
  .mood-option.active {
    background-color: #ffcc99;
    border-color: #ff7f00;
    color: #663300;
  }

  /* hover æ•ˆæœ */
  .mood-option:hover {
    background-color: #ffd6a5;
    border-color: #ff9900;
  }

  button {
    display: block;
    width: 100%;
    margin-top: 15px;
    padding: 12px;
    background-color: #ff7f00;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.2s;
  }

  button:hover {
    background-color: #ff9900;
  }

  #restaurantList li {
    padding: 8px;
    border-bottom: 1px solid #f4c095;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #searchArea input {
    padding: 5px;
    width: 250px;
    margin-right: 10px;
  }

  .hot-section {
    max-width: 420px;
    margin: 20px auto;
    padding: 15px;
    background-color: #fff0e6; /* èˆ‡å…¶ä»–åˆ†é çµ±ä¸€ */
    border: 1px solid #f4c095; /* èˆ‡å…¶ä»–åˆ†é çµ±ä¸€ */
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(245, 139, 84, 0.15);
  }

  /* ---- åˆ†é åˆ‡æ› ---- */
  section,
  .mood-selector,
  .hot-section {
    display: none;
  }

  .active {
    display: block !important;
  }

</style>
</head>
<body>

<div class="hero">
  <h1>ç¾é£Ÿæ¨è–¦å™¨</h1>
</div>

<header>
  <a href="#" onclick="showSection('random')">éš¨æ©ŸæŠ½é¸</a>
  <a href="#" onclick="showSection('filter')">åˆ†é¡ç¯©é¸</a>
  <a href="#" onclick="showSection('mood')">å¿ƒæƒ…é¸æ“‡</a>
  <a href="#" onclick="showSection('custom')">è¼¸å…¥éœ€æ±‚</a>
  <a href="#" onclick="showSection('hot')">é¤å»³æ¨è–¦æ–™ç†</a>
</header>

<!-- ======================
      éš¨æ©ŸæŠ½é¸
======================= -->
<section id="random" class="active">
  <h2>ğŸ² éš¨æ©ŸæŠ½é¸</h2>
  <form id="randomForm">

    <label>åŸå¸‚ï¼š
      <select id="citySelect" onchange="updateDistricts()">
        <option value="">è«‹é¸æ“‡åŸå¸‚</option>
        <option value="keelung">åŸºéš†å¸‚</option>
        <option value="newtaipei">æ–°åŒ—å¸‚</option>
        <option value="taipei">å°åŒ—å¸‚</option>
        <option value="taoyuan">æ¡ƒåœ’å¸‚</option>
        <option value="hsinchucity">æ–°ç«¹å¸‚</option>
        <option value="hsinchucounty">æ–°ç«¹ç¸£</option>
        <option value="yilan">å®œè˜­ç¸£</option>
        <option value="miaoli">è‹—æ —ç¸£</option>
        <option value="taichung">å°ä¸­å¸‚</option>
        <option value="changhua">å½°åŒ–ç¸£</option>
        <option value="nantou">å—æŠ•ç¸£</option>
        <option value="yunlin">é›²æ—ç¸£</option>
        <option value="chiayicity">å˜‰ç¾©å¸‚</option>
        <option value="chiayicounty">å˜‰ç¾©ç¸£</option>
        <option value="tainan">å°å—å¸‚</option>
        <option value="kaohsiung">é«˜é›„å¸‚</option>
        <option value="pingtung">å±æ±ç¸£</option>
        <option value="hualien">èŠ±è“®ç¸£</option>
        <option value="taitung">å°æ±ç¸£</option>
        <option value="penghu">æ¾æ¹–ç¸£</option>
        <option value="kinmen">é‡‘é–€ç¸£</option>
        <option value="lienchiang">é€£æ±Ÿç¸£</option>
      </select>
    </label>

    <label>å€åŸŸï¼š
      <select id="districtSelect">
        <option value="">è«‹å…ˆé¸æ“‡åŸå¸‚</option>
      </select>
    </label>

    <label>ä¸»é£Ÿé¡å‹ï¼š
      <select id="mainType" onchange="checkOtherType()">
        <option value="">è«‹é¸æ“‡</option>
        <option value="é£¯">é£¯</option>
        <option value="éºµ">éºµ</option>
        <option value="ç”œé»">ç”œé»</option>
        <option value="é£²æ–™">é£²æ–™</option>
        <option value="å…¶ä»–">å…¶ä»–</option>
      </select>
    </label>

    <label id="otherInputLabel" style="display:none;">
      è‡ªå®šç¾©ä¸»é£Ÿé¡å‹ï¼š
      <input type="text" id="otherInput" placeholder="ä¾‹å¦‚ï¼šå£½å¸ã€ç‡’è‚‰ã€æ—©åˆé¤â€¦">
    </label>

    <label>å£å‘³ï¼š</label>
    <div class="checkbox-group" id="tasteChecks">
      <label><input type="checkbox" value="é¹¹">é¹¹</label>
      <label><input type="checkbox" value="ç”œ">ç”œ</label>
      <label><input type="checkbox" value="è¾£">è¾£</label>
      <label><input type="checkbox" value="é…¸">é…¸</label>
    </div>

    <label>åƒ¹ä½ï¼š</label>
    <div class="checkbox-group" id="priceChecks">
      <label><input type="checkbox" value="ä¾¿å®œ">ä¾¿å®œ</label>
      <label><input type="checkbox"value="ä¸­ç­‰">ä¸­ç­‰</label>
      <label><input type="checkbox"value="é«˜ç´š">é«˜ç´š</label>
    </div>

    <button type="button" onclick="randomRecommend()">é–‹å§‹éš¨æ©Ÿæ¨è–¦ï¼</button>
  </form>

  <div id="recommendation"></div>
  <div id="map"></div>
</section>

<!-- ======================
      åˆ†é¡ç¯©é¸
======================= -->
<section id="filter">
  <h2>ğŸ± åˆ†é¡ç¯©é¸</h2>

  <label>åŸå¸‚ï¼š
      <select id="categoryCity" onchange="updateCategoryDistricts()">
        <option value="">è«‹é¸æ“‡åŸå¸‚</option>
        <option value="keelung">åŸºéš†å¸‚</option>
        <option value="newtaipei">æ–°åŒ—å¸‚</option>
        <option value="taipei">å°åŒ—å¸‚</option>
        <option value="taoyuan">æ¡ƒåœ’å¸‚</option>
        <option value="hsinchucity">æ–°ç«¹å¸‚</option>
        <option value="hsinchucounty">æ–°ç«¹ç¸£</option>
        <option value="yilan">å®œè˜­ç¸£</option>
        <option value="miaoli">è‹—æ —ç¸£</option>
        <option value="taichung">å°ä¸­å¸‚</option>
        <option value="changhua">å½°åŒ–ç¸£</option>
        <option value="nantou">å—æŠ•ç¸£</option>
        <option value="yunlin">é›²æ—ç¸£</option>
        <option value="chiayicity">å˜‰ç¾©å¸‚</option>
        <option value="chiayicounty">å˜‰ç¾©ç¸£</option>
        <option value="tainan">å°å—å¸‚</option>
        <option value="kaohsiung">é«˜é›„å¸‚</option>
        <option value="pingtung">å±æ±ç¸£</option>
        <option value="hualien">èŠ±è“®ç¸£</option>
        <option value="taitung">å°æ±ç¸£</option>
        <option value="penghu">æ¾æ¹–ç¸£</option>
        <option value="kinmen">é‡‘é–€ç¸£</option>
        <option value="lienchiang">é€£æ±Ÿç¸£</option>
      </select>
    </label>

    <label>å€åŸŸï¼š
      <select id="categoryDistrict">
        <option value="">è«‹å…ˆé¸æ“‡åŸå¸‚</option>
      </select>
    </label>

  <div class="category-buttons">
    <button onclick="filterCategory('é«˜CPå€¼')">é«˜CPå€¼</button>
    <button onclick="filterCategory('ç´„æœƒé¤å»³')">ç´„æœƒé¤å»³</button>
    <button onclick="filterCategory('å¤šäººèšæœƒ')">å¤šäººèšæœƒ</button>
    <button onclick="filterCategory('ç”œé»ä¸‹åˆèŒ¶')">ç”œé»ä¸‹åˆèŒ¶</button>
    <button onclick="filterCategory('å¤œè²“å­')">å¤œè²“å­</button>
    <button onclick="filterCategory('è¶•æ™‚é–“')">è¶•æ™‚é–“</button>
    <button onclick="filterCategory('å¤–å¸¶å¤–é€å‹å–„')">å¤–å¸¶å¤–é€å‹å–„</button>
    <button onclick="filterCategory('ä¸‹é›¨å¤©')">ä¸‹é›¨å¤©</button>
  </div>

  <ul id="restaurantList"></ul>
  <div id="mapFilter"></div>
</section>

<!-- ======================
      å¿ƒæƒ…é¸æ“‡
======================= -->
<section id="mood">
  <h2>é¸æ“‡ä½ çš„ç”¨é¤å¿ƒæƒ… ğŸŠ</h2>

  <label>åŸå¸‚ï¼š
    <select id="moodCity" onchange="updateMoodDistricts()">
      <option value="">è«‹é¸æ“‡åŸå¸‚</option>
      <option value="keelung">åŸºéš†å¸‚</option>
      <option value="newtaipei">æ–°åŒ—å¸‚</option>
      <option value="taipei">å°åŒ—å¸‚</option>
      <option value="taoyuan">æ¡ƒåœ’å¸‚</option>
      <option value="hsinchucity">æ–°ç«¹å¸‚</option>
      <option value="hsinchucounty">æ–°ç«¹ç¸£</option>
      <option value="yilan">å®œè˜­ç¸£</option>
      <option value="miaoli">è‹—æ —ç¸£</option>
      <option value="taichung">å°ä¸­å¸‚</option>
      <option value="changhua">å½°åŒ–ç¸£</option>
      <option value="nantou">å—æŠ•ç¸£</option>
      <option value="yunlin">é›²æ—ç¸£</option>
      <option value="chiayicity">å˜‰ç¾©å¸‚</option>
      <option value="chiayicounty">å˜‰ç¾©ç¸£</option>
      <option value="tainan">å°å—å¸‚</option>
      <option value="kaohsiung">é«˜é›„å¸‚</option>
      <option value="pingtung">å±æ±ç¸£</option>
      <option value="hualien">èŠ±è“®ç¸£</option>
      <option value="taitung">å°æ±ç¸£</option>
      <option value="penghu">æ¾æ¹–ç¸£</option>
      <option value="kinmen">é‡‘é–€ç¸£</option>
      <option value="lienchiang">é€£æ±Ÿç¸£</option>
    </select>
  </label>

  <label>å€åŸŸï¼š
    <select id="moodDistrict">
      <option value="">è«‹å…ˆé¸æ“‡åŸå¸‚</option>
    </select>
  </label>

  <label>è«‹é¸æ“‡å¿ƒæƒ…ï¼š
  <form id="moodForm">
    <label class="mood-option">
      <input type="checkbox" name="mood" value="é–‹å¿ƒ">
      ğŸ˜„ é–‹å¿ƒ / èˆˆå¥®
    </label>

    <label class="mood-option">
      <input type="checkbox" name="mood" value="ç–²å€¦">
      ğŸ˜´ ç–²å€¦ / ç´¯
    </label>

    <label class="mood-option">
      <input type="checkbox" name="mood" value="å‚·å¿ƒ">
      ğŸ˜¢ å‚·å¿ƒ / ä½è½
    </label>

    <label class="mood-option">
      <input type="checkbox" name="mood" value="æ”¾é¬†">
      ğŸ§˜â€â™€ï¸ æ”¾é¬† / æ‚ é–’
    </label>

    <label class="mood-option">
      <input type="checkbox" name="mood" value="å¿™ç¢Œ">
      â±ï¸ å¿™ç¢Œ / åŒ†å¿™
    </label>
    <button type="button" onclick="moodSearch(event)">æ¨è–¦ç¾é£Ÿ</button>

    <ul id="moodRestaurantList"></ul>
    <div id="mapMood"></div>
  </form>
</section>
<!-- ======================
      è¼¸å…¥éœ€æ±‚
======================= -->
<section id="custom">
  <h2>ğŸ” è¼¸å…¥éœ€æ±‚</h2>

  <label>åŸå¸‚ï¼š
    <select id="customCity" onchange="updateCustomDistricts()">
      <option value="">è«‹é¸æ“‡åŸå¸‚</option>
      <option value="keelung">åŸºéš†å¸‚</option>
      <option value="newtaipei">æ–°åŒ—å¸‚</option>
      <option value="taipei">å°åŒ—å¸‚</option>
      <option value="taoyuan">æ¡ƒåœ’å¸‚</option>
      <option value="hsinchucity">æ–°ç«¹å¸‚</option>
      <option value="hsinchucounty">æ–°ç«¹ç¸£</option>
      <option value="yilan">å®œè˜­ç¸£</option>
      <option value="miaoli">è‹—æ —ç¸£</option>
      <option value="taichung">å°ä¸­å¸‚</option>
      <option value="changhua">å½°åŒ–ç¸£</option>
      <option value="nantou">å—æŠ•ç¸£</option>
      <option value="yunlin">é›²æ—ç¸£</option>
      <option value="chiayicity">å˜‰ç¾©å¸‚</option>
      <option value="chiayicounty">å˜‰ç¾©ç¸£</option>
      <option value="tainan">å°å—å¸‚</option>
      <option value="kaohsiung">é«˜é›„å¸‚</option>
      <option value="pingtung">å±æ±ç¸£</option>
      <option value="hualien">èŠ±è“®ç¸£</option>
      <option value="taitung">å°æ±ç¸£</option>
      <option value="penghu">æ¾æ¹–ç¸£</option>
      <option value="kinmen">é‡‘é–€ç¸£</option>
      <option value="lienchiang">é€£æ±Ÿç¸£</option>
    </select>
  </label>

  <label>å€åŸŸï¼š
    <select id="customDistrict">
      <option value="">è«‹å…ˆé¸æ“‡åŸå¸‚</option>
    </select>
  </label>

  <label>è«‹è¼¸å…¥æ‚¨çš„éœ€æ±‚ï¼ˆä¾‹ï¼šæˆ‘æƒ³åƒæ‹‰éºµã€æƒ³æ‰¾ç´„æœƒé¤å»³â€¦ï¼‰ï¼š
    <input id="freeText" type="text" placeholder="ä¾‹å¦‚ï¼šæˆ‘æƒ³åƒä¾¿å®œæ‹‰éºµ">
  </label>

  <button onclick="customSearch()">é€å‡ºæœå°‹</button>

  <div id="customResults"></div>
  <div id="mapCustom"></div>
</section>

<!-- ======================
      é¤å»³æ¨è–¦æ–™ç†
======================= -->
<section id="hot">
  <h2>ğŸ”¥ é¤å»³æ¨è–¦æ–™ç†</h2>

  <div id="searchArea">
    <input type="text" id="restaurantInput" placeholder="è¼¸å…¥é¤å»³åç¨±...">
    <button type="button" onclick="searchRestaurant(event)">æœå°‹</button>
  </div>

  <ul id="restaurantResults"></ul>

  <h3 style="color:#62422b;">ğŸ½ æ¨è–¦æ–™ç†ï¼ˆTop 10ï¼‰</h3>
  <ul id="topDishList"></ul>
</section>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
/* ===================== CONFIG ===================== */
async function postAPI(payload) {
  try {
    const res = await fetch("https://food123-lhfa.onrender.com/gemini", { //å‘¼å«proxy server
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      mode: 'cors',
      body: JSON.stringify(payload)
    });
    const data = await res.text(); //å›å‚³jsonç‰©ä»¶
    return JSON.parse(data);
  } catch (err) {
    console.error('postAPI error', err);
    return { ok: false, error: err.message || String(err) };
  }
}

/* ===================== åœ°åœ–åˆå§‹åŒ–ï¼ˆLeafletï¼‰ ===================== */
const defaultCenter = [25.033, 121.565]; // å°åŒ—ä¸­å¿ƒä½œç‚ºé è¨­
let map = L.map('map').setView(defaultCenter, 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let mapFilter = L.map('mapFilter').setView(defaultCenter, 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(mapFilter);

let mapMood = L.map('mapMood').setView(defaultCenter, 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(mapMood);

let mapCustom = L.map('mapCustom').setView(defaultCenter, 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(mapCustom);

/* marker holders */
let singleMarker = null;
let filterMarkers = [];
let moodMarkers = [];
let customMarkers = [];

/* -------------------- UI helpers -------------------- */
function showSection(id) {
  document.querySelectorAll('section')
    .forEach(s => s.classList.remove('active'));

  const el = document.getElementById(id);
  if (el) el.classList.add('active');

  setTimeout(() => {
    if (window.map && id === "random") map.invalidateSize();
    if (window.mapFilter && id === "filter") mapFilter.invalidateSize();
    if (window.mapMood && id === "mood") mapMood.invalidateSize();
    if (window.mapCustom && id === "custom") mapCustom.invalidateSize();
    if (window.mapHot && id === "hot") mapHot.invalidateSize();
  }, 100);
}

/* -------------------- city/district data & helpers -------------------- */
const districts = {
      keelung: ['ä»æ„›å€', 'ä¿¡ç¾©å€', 'ä¸­æ­£å€', 'ä¸­å±±å€', 'å®‰æ¨‚å€', 'æš–æš–å€', 'ä¸ƒå µå€'],
      taipei: ['åŒ—æŠ•å€', 'å£«æ—å€', 'ä¸­å±±å€', 'å…§æ¹–å€', 'å¤§åŒå€', 'æ¾å±±å€', 'å¤§å®‰å€', 'ä¿¡ç¾©å€', 'å—æ¸¯å€', 'ä¸­æ­£å€', 'è¬è¯å€', 'æ–‡å±±å€'],
      newtaipei: ['æ¿æ©‹å€', 'æ–°èŠå€', 'ä¸­å’Œå€', 'æ°¸å’Œå€', 'åœŸåŸå€', 'æ¨¹æ—å€', 'ä¸‰å³½å€', 'é¶¯æ­Œå€', 'ä¸‰é‡å€', 'è˜†æ´²å€', 'äº”è‚¡å€', 'æ³°å±±å€',
                'æ—å£å€', 'å…«é‡Œå€', 'æ·¡æ°´å€', 'ä¸‰èŠå€', 'çŸ³é–€å€', 'é‡‘å±±å€', 'è¬é‡Œå€', 'æ±æ­¢å€', 'ç‘èŠ³å€', 'è²¢å¯®å€', 'å¹³æºªå€', 'é›™æºªå€', 'æ–°åº—å€',
                'æ·±å‘å€', 'çŸ³ç¢‡å€', 'åªæ—å€', 'çƒä¾†å€'],
      taoyuan: ['æ¡ƒåœ’å€', 'ä¸­å£¢å€', 'å¹³é®å€', 'å…«å¾·å€', 'æ¥Šæ¢…å€', 'è˜†ç«¹å€', 'å¤§æºªå€', 'é¾æ½­å€', 'é¾œå±±å€', 'å¤§åœ’å€', 'è§€éŸ³å€', 'æ–°å±‹å€', 'å¾©èˆˆå€'],
      hsinchucity: ['æ±å€', 'åŒ—å€', 'é¦™å±±å€'],
      hsinchucounty: ['ç«¹åŒ—å¸‚', 'ç«¹æ±é®', 'æ–°åŸ”é®', 'é—œè¥¿é®', 'æ¹–å£é„‰', 'æ–°è±é„‰', 'èŠæ—é„‰', 'æ©«å±±é„‰', 'åŒ—åŸ”é„‰', 'å¯¶å±±é„‰', 'å³¨çœ‰é„‰', 'å°–çŸ³é„‰', 'äº”å³°é„‰'],
      yilan: ['å®œè˜­å¸‚', 'ç¾…æ±é®', 'è˜‡æ¾³é®', 'é ­åŸé®', 'ç¤æºªé„‰', 'å£¯åœé„‰', 'å“¡å±±é„‰', 'å†¬å±±é„‰', 'äº”çµé„‰', 'ä¸‰æ˜Ÿé„‰', 'å¤§åŒé„‰', 'å—æ¾³é„‰'],
      miaoli: ['è‹—æ —å¸‚', 'é ­ä»½å¸‚', 'è‹‘è£¡é®', 'é€šéœ„é®', 'ç«¹å—é®', 'å¾Œé¾é®', 'å“è˜­é®', 'å¤§æ¹–é„‰', 'å…¬é¤¨é„‰', 'éŠ…é‘¼é„‰', 'å—åº„é„‰', 'é ­å±‹é„‰', 'ä¸‰ç¾©é„‰', 'è¥¿æ¹–é„‰', 'é€ æ©‹é„‰', 'ä¸‰ç£é„‰', 'ç…æ½­é„‰', 'æ³°å®‰é„‰'],
      taichung: ['ä¸­å€', 'æ±å€', 'å—å€', 'è¥¿å€', 'åŒ—å€', 'åŒ—å±¯å€', 'è¥¿å±¯å€', 'å—å±¯å€', 'å¤ªå¹³å€', 'å¤§é‡Œå€', 'éœ§å³°å€', 'çƒæ—¥å€', 'è±åŸå€', 'åé‡Œå€', 'çŸ³å²¡å€',
                 'æ±å‹¢å€', 'å’Œå¹³å€', 'æ–°ç¤¾å€', 'æ½­å­å€', 'å¤§é›…å€', 'ç¥å²¡å€', 'å¤§è‚šå€', 'æ²™é¹¿å€', 'é¾äº•å€', 'æ¢§æ£²å€', 'æ¸…æ°´å€', 'å¤§ç”²å€', 'å¤–åŸ”å€', 'å¤§å®‰å€'],
      changhua: ['å½°åŒ–å¸‚', 'å“¡æ—å¸‚', 'å’Œç¾é®', 'é¹¿æ¸¯é®', 'æºªæ¹–é®', 'äºŒæ—é®', 'ç”°ä¸­é®', 'åŒ—æ–—é®', 'èŠ±å£‡é„‰', 'èŠ¬åœ’é„‰', 'å¤§æ‘é„‰', 'æ°¸é–é„‰', 'ä¼¸æ¸¯é„‰', 'ç·šè¥¿é„‰',
                 'ç¦èˆˆé„‰', 'ç§€æ°´é„‰', 'åŸ”å¿ƒé„‰', 'åŸ”é¹½é„‰', 'å¤§åŸé„‰', 'ç«¹å¡˜é„‰', 'æºªå·é„‰', 'ç”°å°¾é„‰', 'åŸ¤é ­é„‰', 'èŠ³è‹‘é„‰', 'ç¤¾é ­é„‰', 'äºŒæ°´é„‰'],
      nantou: ['å—æŠ•å¸‚', 'åŸ”é‡Œé®', 'è‰å±¯é®', 'ç«¹å±±é®', 'é›†é›†é®', 'åé–“é„‰', 'é¹¿è°·é„‰', 'ä¸­å¯®é„‰', 'é­šæ± é„‰', 'åœ‹å§“é„‰', 'æ°´é‡Œé„‰', 'ä¿¡ç¾©é„‰', 'ä»æ„›é„‰'],
      yunlin: ['æ–—å…­å¸‚', 'æ–—å—é®', 'è™å°¾é®', 'è¥¿èºé®', 'åœŸåº«é®', 'åŒ—æ¸¯é®', 'è¿æ¡é„‰', 'æ—å…§é„‰', 'å¤å‘é„‰', 'å¤§åŸ¤é„‰', 'äºŒå´™é„‰', 'å´™èƒŒé„‰', 'éº¥å¯®é„‰', 'æ±å‹¢é„‰', 'è¤’å¿ é„‰', 'å°è¥¿é„‰', 'å…ƒé•·é„‰', 'å››æ¹–é„‰', 'å£æ¹–é„‰', 'æ°´æ—é„‰'],
      chiayicity: ['æ±å€', 'è¥¿å€'],
      chiayicounty: ['å¤ªä¿å¸‚', 'æœ´å­å¸‚', 'å¸ƒè¢‹é®', 'å¤§æ—é®', 'æ°‘é›„é„‰', 'æºªå£é„‰', 'æ–°æ¸¯é„‰', 'å…­è…³é„‰', 'æ±çŸ³é„‰', 'ç¾©ç«¹é„‰', 'é¹¿è‰é„‰', 'æ°´ä¸Šé„‰', 'ä¸­åŸ”é„‰', 'ç«¹å´é„‰', 'æ¢…å±±é„‰', 'ç•ªè·¯é„‰', 'å¤§åŸ”é„‰', 'é˜¿é‡Œå±±é„‰'],
      tainan: ['ä¸­è¥¿å€', 'æ±å€', 'å—å€', 'åŒ—å€', 'å®‰å¹³å€', 'å®‰å—å€', 'æ°¸åº·å€', 'æ­¸ä»å€', 'æ–°åŒ–å€', 'å·¦é®å€', 'ç‰äº•å€', 'æ¥ è¥¿å€', 'å—åŒ–å€', 'ä»å¾·å€', 'é—œå»Ÿå€',
             'é¾å´å€', 'å®˜ç”°å€', 'éº»è±†å€', 'ä½³é‡Œå€', 'è¥¿æ¸¯å€', 'ä¸ƒè‚¡å€', 'å°‡è»å€', 'å­¸ç”²å€', 'åŒ—é–€å€', 'æ–°ç‡Ÿå€', 'å¾Œå£å€', 'ç™½æ²³å€', 'æ±å±±å€', 'å…­ç”²å€', 'ä¸‹ç‡Ÿå€',
              'æŸ³ç‡Ÿå€', 'é¹½æ°´å€', 'å–„åŒ–å€', 'å¤§å…§å€', 'å±±ä¸Šå€', 'æ–°å¸‚å€', 'å®‰å®šå€'],
      kaohsiung: ['æ–°èˆˆå€', 'å‰é‡‘å€', 'è‹“é›…å€', 'é¹½åŸ•å€', 'é¼“å±±å€', 'æ——æ´¥å€', 'å‰é®å€', 'ä¸‰æ°‘å€', 'æ¥ æ¢“å€', 'å°æ¸¯å€', 'å·¦ç‡Ÿå€', 'ä»æ­¦å€', 'å¤§ç¤¾å€', 'å²¡å±±å€', 'è·¯ç«¹å€',
                'é˜¿è“®å€', 'ç”°å¯®å€', 'ç‡•å·¢å€', 'æ©‹é ­å€', 'æ¢“å®˜å€', 'å½Œé™€å€', 'æ°¸å®‰å€', 'æ¹–å…§å€', 'é³³å±±å€', 'å¤§å¯®å€', 'æ—åœ’å€', 'é³¥æ¾å€', 'å¤§æ¨¹å€', 'æ——å±±å€', 'ç¾æ¿ƒå€', 'å…­é¾œå€',
                 'å…§é–€å€', 'æ‰æ—å€', 'ç”²ä»™å€', 'æ¡ƒæºå€', 'é‚£ç‘ªå¤å€', 'èŒ‚æ—å€', 'èŒ„è£å€'],
      pingtung: ['å±æ±å¸‚', 'æ½®å·é®', 'æ±æ¸¯é®', 'æ†æ˜¥é®', 'è¬ä¸¹é„‰', 'é•·æ²»é„‰', 'éºŸæ´›é„‰', 'ä¹å¦‚é„‰', 'é‡Œæ¸¯é„‰', 'é¹½åŸ”é„‰', 'é«˜æ¨¹é„‰', 'è¬å·’é„‰', 'å…§åŸ”é„‰', 'ç«¹ç”°é„‰', 'æ–°åŸ¤é„‰', 'æ‹å¯®é„‰',
                 'æ‹å±±é„‰', 'æ˜¥æ—¥é„‰', 'ç…å­é„‰', 'è»ŠåŸé„‰', 'ç‰¡ä¸¹é„‰', 'æ†æ˜¥é„‰', 'æ»¿å·é„‰', 'ä¸‰åœ°é–€é„‰', 'éœ§å°é„‰', 'ç‘ªå®¶é„‰', 'æ³°æ­¦é„‰', 'ä¾†ç¾©é„‰', 'å—å·é„‰', 'ä½³å†¬é„‰', 'æ—é‚Šé„‰', 'æ±æ¸¯é„‰', 'ç‰çƒé„‰', 'æ‹å±±é„‰', 'è»ŠåŸé„‰'],
      hualien: ['èŠ±è“®å¸‚', 'ç‰é‡Œé®', 'æ–°åŸé„‰', 'å‰å®‰é„‰', 'å£½è±é„‰', 'é³³æ—é®', 'å…‰å¾©é„‰', 'è±æ¿±é„‰', 'ç‘ç©—é„‰', 'è¬æ¦®é„‰', 'å¯Œé‡Œé„‰', 'å“æºªé„‰'],
      taitung: ['å°æ±å¸‚', 'æˆåŠŸé®', 'é—œå±±é®', 'é•·æ¿±é„‰', 'æµ·ç«¯é„‰', 'æ± ä¸Šé„‰', 'æ±æ²³é„‰', 'é¹¿é‡é„‰', 'å»¶å¹³é„‰', 'å‘å—é„‰', 'é‡‘å³°é„‰', 'å¤§æ­¦é„‰', 'é”ä»é„‰', 'ç¶ å³¶é„‰', 'è˜­å¶¼é„‰', 'å¤ªéº»é‡Œé„‰'],
      penghu: ['é¦¬å…¬å¸‚', 'æ¹–è¥¿é„‰', 'ç™½æ²™é„‰', 'è¥¿å¶¼é„‰', 'æœ›å®‰é„‰', 'ä¸ƒç¾é„‰'],
      kinmen: ['é‡‘æ²™é®', 'é‡‘æ¹–é®', 'é‡‘å¯§é„‰', 'é‡‘åŸé®', 'çƒˆå¶¼é„‰', 'çƒåµé„‰'],
      lienchiang: ['å—ç«¿é„‰', 'åŒ—ç«¿é„‰', 'è’å…‰é„‰', 'æ±å¼•é„‰']
    };

function updateDistricts(){
  const city = document.getElementById('citySelect').value;
  const sel = document.getElementById('districtSelect');
  sel.innerHTML = '<option value="">å…¨éƒ¨</option>';
  if (city && districts[city]) {
    districts[city].forEach(d => {
      const o = document.createElement('option'); o.value = d; o.textContent = d; sel.appendChild(o);
    });
  } else {
    sel.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡åŸå¸‚</option>';
  }
}
function updateCategoryDistricts(){
  const city = document.getElementById('categoryCity').value;
  const sel = document.getElementById('categoryDistrict');
  sel.innerHTML = '<option value="">å…¨éƒ¨</option>';
  if (city && districts[city]) {
    districts[city].forEach(d => {
      const o = document.createElement('option'); o.value = d; o.textContent = d; sel.appendChild(o);
    });
  } else {
    sel.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡åŸå¸‚</option>';
  }
}
function updateMoodDistricts(){
  const city = document.getElementById('moodCity').value;
  const sel = document.getElementById('moodDistrict');
  sel.innerHTML = '<option value="">å…¨éƒ¨</option>';
  if (city && districts[city]) {
    districts[city].forEach(d => {
      const o = document.createElement('option'); o.value = d; o.textContent = d; sel.appendChild(o);
    });
  } else {
    sel.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡åŸå¸‚</option>';
  }
}
function updateCustomDistricts(){
  const city = document.getElementById('customCity').value;
  const sel = document.getElementById('customDistrict');
  sel.innerHTML = '<option value="">å…¨éƒ¨</option>';
  if (city && districts[city]) {
    districts[city].forEach(d => {
      const o = document.createElement('option'); o.value = d; o.textContent = d; sel.appendChild(o);
    });
  } else {
    sel.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡åŸå¸‚</option>';
  }
}
function checkOtherType(){
  const main = document.getElementById('mainType').value;
  document.getElementById('otherInputLabel').style.display = main === 'å…¶ä»–' ? 'block' : 'none';
}

/* ===================== éš¨æ©ŸæŠ½é¸ï¼ˆå‘¼å« Gemini via backend recommendï¼‰ ===================== */
async function randomRecommend() {
  // æ”¶é›†æ¢ä»¶
  const city = document.getElementById('citySelect').value;
  const district = document.getElementById('districtSelect').value;
  const mainType = document.getElementById('mainType').value;
  const otherType = document.getElementById('otherInput').value;
  const tastes = Array.from(document.querySelectorAll('#tasteChecks input[type=checkbox]:checked')).map(i=>i.value);
  const prices = Array.from(document.querySelectorAll('#priceChecks input[type=checkbox]:checked')).map(i=>i.value);

  const queryType = mainType === 'å…¶ä»–' && otherType ? otherType : (mainType || '');

  const options = {
    mode: 'random',
    city, district,
    mainType: queryType,
    tastes, prices
  };

  // UI
  const recDiv = document.getElementById('recommendation');
  recDiv.innerHTML = 'è«‹ç¨å€™ï¼Œæ­£åœ¨ä½¿ç”¨ Gemini ç”Ÿæˆæ¨è–¦...';

  const resp = await postAPI({ action: 'recommend', options });
  if (!resp || !resp.ok) {
    recDiv.innerHTML = 'æ¨è–¦å¤±æ•—ï¼š' + (resp ? (resp.error || JSON.stringify(resp)) : 'ç„¡å›æ‡‰');
    return;
  }

  const list = resp.restaurants;
  if (!Array.isArray(list) || list.length === 0) {
    recDiv.innerHTML = 'æ²’æœ‰çµæœ';
    return;
  }

  // å¾ç”Ÿæˆæ¸…å–®ä¸­éš¨æ©ŸæŒ‘ä¸€é–“é¡¯ç¤ºã€ä¸¦åœ¨åœ°åœ–ä¸Šæ¨™è¨˜
  const choice = list[Math.floor(Math.random()*list.length)];
  renderSingleRecommendation(choice);
}

/* é¡¯ç¤ºå–®ä¸€æ¨è–¦ (random) */
function renderSingleRecommendation(choice) {
  const recDiv = document.getElementById('recommendation');
  recDiv.innerHTML = '';
  if (!choice) { recDiv.innerHTML = 'æ²’æœ‰æ¨è–¦'; return; }
  const title = document.createElement('h3'); title.textContent = choice.name || 'Unnamed';
  const p = document.createElement('p'); p.innerHTML = `${choice.address || ''} ${choice.price ? 'ï½œ' + choice.price : ''}<br>${choice.reason || ''}`;
  

  recDiv.appendChild(title); recDiv.appendChild(p);

  // map
  if (singleMarker) {
    map.removeLayer(singleMarker);
    singleMarker = null;
  }
  if (choice.lat && choice.lng) {
    singleMarker = L.marker([choice.lat, choice.lng]).addTo(map).bindPopup(`<b>${choice.name}</b><br>${choice.address || ''}`).openPopup();
    map.setView([choice.lat, choice.lng], 15);
  } else {
    // å¦‚æœæ²’æœ‰åº§æ¨™ï¼Œå˜—è©¦ä¸æ”¹è®Šåœ°åœ–ä¸¦é¡¯ç¤ºæç¤º
    map.setView(defaultCenter, 12);
  }
}

/* ===================== åˆ†é¡ç¯©é¸ï¼ˆé¡¯ç¤ºå¤šç­†ï¼‰ ===================== */
async function filterCategory(category) {
  const city = document.getElementById('categoryCity').value;
  const district = document.getElementById('categoryDistrict').value;
  const options = { mode: 'category', category, city, district };

  const listDiv = document.getElementById('restaurantList');
  listDiv.innerHTML = 'æœå°‹ä¸­ï¼ˆç”± Gemini ç”Ÿæˆï¼‰...';

  const resp = await postAPI({ action: 'recommend', options });
  if (!resp || !resp.ok) {
    listDiv.innerHTML = 'æœå°‹å¤±æ•—ï¼š' + (resp ? (resp.error || JSON.stringify(resp)) : 'ç„¡å›æ‡‰');
    return;
  }
  const list = resp.restaurants || [];
  listDiv.innerHTML = '';

  // æ¸…é™¤åŸæœ¬ markers
  filterMarkers.forEach(m => mapFilter.removeLayer(m));
  filterMarkers = [];

  if (list.length === 0) {
    listDiv.innerHTML = '<li>ç„¡çµæœ</li>';
    return;
  }

  list.forEach(p => {
      // å»ºç«‹åˆ—è¡¨é …ç›®
      const li = document.createElement('li');
      li.innerHTML = `<span style="display:block">
                          ${p.name} ${p.price ? 'ï½œ' + p.price : ''} <br>
                          <small>${p.address || ''}</small>
                      </span>`;

      // åŠ åˆ°åˆ—è¡¨å®¹å™¨
      listDiv.appendChild(li);

      // å¦‚æœæœ‰ç¶“ç·¯åº¦å°±åŠ åˆ°åœ°åœ–ä¸Š
      if (p.lat && p.lng) {
          const m = L.marker([p.lat, p.lng])
                      .addTo(mapFilter)
                      .bindPopup(`<b>${p.name}</b><br>${p.address || ''}`);
          filterMarkers.push(m);
      }
  });

  // èšç„¦åˆ°ç¬¬ä¸€å€‹æœ‰åº§æ¨™çš„é»
  const first = list.find(x => x.lat && x.lng);
  if (first) mapFilter.setView([first.lat, first.lng], 13);
}

/* ===================== å¿ƒæƒ…æŒ‰éˆ•è®Šè‰² ===================== */
document.querySelectorAll('.mood-option').forEach(option => {
  option.addEventListener('click', function () {
    // å–æ¶ˆå…¶ä»–é¸é …
    document.querySelectorAll('.mood-option').forEach(o => o.classList.remove('active'));
    document.querySelectorAll('.mood-option input').forEach(i => (i.checked = false));

    // è¨­å®šç›®å‰é€™å€‹
    this.classList.add('active');
    this.querySelector('input').checked = true;
  });
});

/* ===================== å¿ƒæƒ…æœå°‹ï¼ˆé¡¯ç¤ºå¤šç­†ï¼‰ ===================== */
async function moodSearch(event) {
  if (event) event.preventDefault(); // é¿å… form é‡æ–°æ•´ç†

  const city = document.getElementById('moodCity').value;
  const district = document.getElementById('moodDistrict').value;

  // å–å¾—å¤šå€‹å‹¾é¸çš„å¿ƒæƒ…
  const moods = [...document.querySelectorAll('input[name="mood"]:checked')].map(m => m.value);

  if (moods.length === 0) {
    alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å¿ƒæƒ…ï¼");
    return;
  }

  const options = { mode: 'mood', moods, city, district };

  const listDiv = document.getElementById('moodRestaurantList');
  listDiv.innerHTML = 'æœå°‹ä¸­ï¼ˆç”± Gemini ç”Ÿæˆï¼‰...';

  const resp = await postAPI({ action: 'recommend', options });
  if (!resp || !resp.ok) {
    listDiv.innerHTML = 'æœå°‹å¤±æ•—ï¼š' +
      (resp ? (resp.error || JSON.stringify(resp)) : 'ç„¡å›æ‡‰');
    return;
  }

  const list = resp.restaurants || [];
  listDiv.innerHTML = '';

  // ===== æ¸…é™¤èˆŠ marker =====
  if (window.moodMarkers) {
    moodMarkers.forEach(m => mapMood.removeLayer(m));
  }
  window.moodMarkers = [];

  if (list.length === 0) {
    listDiv.innerHTML = '<li>ç„¡çµæœ</li>';
    return;
  }

  // ===== é¡¯ç¤ºçµæœèˆ‡æ¨™è¨˜åœ°åœ– =====
  list.forEach(p => {
      const li = document.createElement('li');
      li.innerHTML = `<span style="display:block">
                          ${p.name} ${p.price ? 'ï½œ' + p.price : ''} <br>
                          <small>${p.address || ''}</small>
                      </span>`;
      listDiv.appendChild(li);

      if (p.lat && p.lng) {
          const m = L.marker([p.lat, p.lng])
                      .addTo(mapMood)
                      .bindPopup(`<b>${p.name}</b><br>${p.address || ''}`);
          moodMarkers.push(m);
      }
  });

  // ===== èšç„¦åˆ°ç¬¬ä¸€ç­†æœ‰åº§æ¨™çš„ =====
  const first = list.find(x => x.lat && x.lng);
  if (first) mapMood.setView([first.lat, first.lng], 13);
}

/* ===================== è‡ªè¨‚éœ€æ±‚ï¼ˆfree textï¼‰ ===================== */
async function customSearch() {
  const city = document.getElementById('customCity').value;
  const district = document.getElementById('customDistrict').value;
  const freeText = document.getElementById('freeText').value.trim();
  if (!freeText) return alert('è«‹è¼¸å…¥éœ€æ±‚');

  const options = { mode: 'custom', city, district, query: freeText };

  const resultsDiv = document.getElementById('customResults');
  resultsDiv.innerHTML = 'æœå°‹ä¸­ï¼ˆç”± Gemini ç”Ÿæˆï¼‰...';

  const resp = await postAPI({ action: 'recommend', options });
  if (!resp || !resp.ok) {
    resultsDiv.innerHTML = 'æœå°‹å¤±æ•—ï¼š' + (resp ? (resp.error || JSON.stringify(resp)) : 'ç„¡å›æ‡‰');
    return;
  }

  const list = resp.restaurants || [];
  resultsDiv.innerHTML = '';

  // æ¸…æ‰ custom markers
  customMarkers.forEach(m => mapCustom.removeLayer(m));
  customMarkers = [];

  if (list.length === 0) {
    resultsDiv.innerHTML = '<div>ç„¡çµæœ</div>';
    return;
  }

  list.forEach(p => {
    const el = document.createElement('div');
    el.style.borderBottom = '1px solid #f4c095';
    el.style.padding = '8px 0';

    // âŒ å·²ç§»é™¤æ”¶è—æŒ‰éˆ•
    el.innerHTML = `
      <strong>${p.name}</strong>
      <div>${p.address || ''}</div>
      <div style="font-size:0.9rem;">${p.reason || ''}</div>
    `;

    resultsDiv.appendChild(el);

    if (p.lat && p.lng) {
      const m = L.marker([p.lat, p.lng]).addTo(mapCustom)
                .bindPopup(`<b>${p.name}</b><br>${p.address || ''}`);
      customMarkers.push(m);
    }
  });

  const first = list.find(x => x.lat && x.lng);
  if (first) mapCustom.setView([first.lat, first.lng], 13);
}

/* ===================== é¤å»³æ–™ç†æœå°‹ï¼ˆTop 10ï¼‰ ===================== */
async function searchRestaurant(event) {
  if (event) event.preventDefault();

  const name = document.getElementById('restaurantInput').value.trim();
  const resultDiv = document.getElementById('restaurantResults');
  const dishDiv = document.getElementById('topDishList');

  if (!name) {
    alert("è«‹è¼¸å…¥é¤å»³åç¨±ï¼");
    return;
  }

  resultDiv.innerHTML = "æœå°‹ä¸­â€¦";
  dishDiv.innerHTML = "";

  // ====== å‘¼å«å¾Œç«¯ï¼šæ‰¾é¤å»³ï¼‹ç†±é–€æ–™ç† ======
  const resp = await postAPI({
    action: "hotdish",
    restaurant: name
  });

  if (!resp || !resp.ok) {
    resultDiv.innerHTML = "æœå°‹å¤±æ•—ï¼š" +
      (resp ? (resp.error || JSON.stringify(resp)) : "ç„¡å›æ‡‰");
    return;
  }

  // ====== é¡¯ç¤ºé¤å»³è³‡è¨Š ======
  const restaurant = resp.parsed.restaurant;
  if (!restaurant) {
    resultDiv.innerHTML = "<li>æ‰¾ä¸åˆ°é¤å»³</li>";
    return;
  }

  resultDiv.innerHTML = `
    <li>
      <b>${restaurant.name}</b><br>
      <small>${restaurant.address || ""}</small>
    </li>
  `;

  // ====== é¡¯ç¤º Top 10 èœè‰² ======
  const dishes = resp.restaurants.dishes || [];

  if (dishes.length === 0) {
    dishDiv.innerHTML = "<li>æ²’æœ‰æ‰¾åˆ°æ¨è–¦æ–™ç†</li>";
    return;
  }

  dishDiv.innerHTML = "";
  dishes.slice(0, 10).forEach((d, i) => {
    const li = document.createElement("li");
    li.innerHTML = `#${i + 1}ã€€${d.name} ${d.score ? "ï½œç†±é–€åˆ†æ•¸ï¼š" + d.score : ""}`;
    dishDiv.appendChild(li);
  });
}

/* ===================== åˆå§‹åŒ–ä¸€äº› UI ===================== */
updateDistricts();
updateCustomDistricts();

/* ----------------- favorite sidebar toggle ----------------- */
// document.getElementById('toggleFavorites').addEventListener('click', () => {
//   document.getElementById('favoriteSidebar').classList.toggle('active');
// });
</script>
</body>
</html>
